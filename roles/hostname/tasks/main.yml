---
## ---------------- ##
## Set the hostname ##
## ---------------- ##

- name: change hostname if the new name is different than the current
  vars:
    hostname_new: "{{ new_hostname | default(inventory_hostname )}}"
  when: new_hostname != ansible_hostname
  block:
    - name: change the hostname
      hostname:
        name: "{{ hostname_new }}"

    - name: change the hostname in the /etc/hosts
      replace:
        path: /etc/hosts
        regexp: '(?i){{ ansible_hostname }}'
        replace: "{{ hostname_new }}"

    - name: reboot
      reboot:
        reboot_timeout: 600
