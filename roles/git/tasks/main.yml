---
## ------------------------------------------------------------ ##
## Installs Git, and clones, configures and pushes repositories ##
## ------------------------------------------------------------ ##

- name: check if git is accessible via path
  ansible.builtin.include_tasks: install_git.yml

- name: git global config
  loop: "{{ git.global | default({}) | dict2items }}"
  loop_control:
    loop_var: git_global_config_item
  ansible.builtin.include_tasks: git_config.yml
  vars:
    git_config: "{{ git_global_config_item | combine({'scope': 'global'}) }}"

- name: push repositories
  loop: "{{ git.pushes | default([]) }}"
  loop_control:
    loop_var: git_push
  ansible.builtin.include_tasks: git_push.yml

- name: clone repositories
  loop: "{{ git.clones | default([]) }}"
  loop_control:
    loop_var: git_clone
  ansible.builtin.include_tasks: git_clone.yml

- name: "Copy git_utils.sh to: {{ git.utils_path }}"
  when: git.utils_path is defined
  copy:
    src: git_utils.sh
    dest: "{{ git.utils_path }}"
    mode: u=rw,g=r,o-rwx
