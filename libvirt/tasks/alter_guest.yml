---
## ------------------------------------- ##
## Alter a VM via its XML representation ##
## ------------------------------------- ##

- name: shutdown VM
  include: shutdown_guest.yml

- name: alter cpu topology and affinity
  when: libvirt_vm.alter_domain.cpuset is defined
  include: alter_cpus.yml
  vars:
    libvirt_cpu: "{{ libvirt_vm.alter_domain.cpuset }}"

- name: alter VM by XPath
  when: libvirt_vm.alter_domain.xpaths is defined
  loop: "{{ libvirt_vm.alter_domain.xpaths | default([]) }}"
  loop_control:
    loop_var: alter_domain_xpath
  include: alter_xpath.yml
  vars:
    libvirt_xpath: "{{ alter_domain_xpath }}"

# - fail:
#     msg: boom
