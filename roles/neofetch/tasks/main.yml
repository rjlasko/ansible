---
## ------------------- ##
## Installs 'neofetch' ##
## ------------------- ##

- name: check if neofetch is accessible via path
  ansible.builtin.command: command -V neofetch
  changed_when: false
  ignore_errors: true
  register: neofetch_exists

- name: local user installation
  when: >
    neofetch_exists.rc != 0
    and (neofetch_install_home_bin | default(false))
  block:
    - name: bin directory must exist
      ansible.builtin.file:
        path: ~/bin
        state: directory
        mode: u=rwx

    - name: check if neofetch is where we will want to put it
      ansible.builtin.stat:
        path: ~/bin/neofetch
      register: neofetch_in_target

    - name: get from github
      when: not neofetch_in_target.stat.exists
      ansible.builtin.get_url:
        url: https://raw.githubusercontent.com/dylanaraps/neofetch/master/neofetch
        dest: ~/bin/neofetch
        mode: u=rx
        force: true

- name: check if neofetch is accessible via path
  ansible.builtin.command: command -V neofetch
  changed_when: false
  ignore_errors: true
  register: neofetch_exists

- name: install if not already installed
  when: neofetch_exists.rc != 0
  block:
    - name: system install neofetch
      when: ansible_facts.system == 'Linux'
      ansible.builtin.package:
        name: neofetch
        state: present

    - name: brew install neofetch
      when: ansible_facts.system == 'Darwin'
      community.general.homebrew:
        name: neofetch
        state: present
