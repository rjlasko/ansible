---
## ---------------------------------------------------------------- ##
## Automates the installation and setup of LXC hosts and containers ##
## ---------------------------------------------------------------- ##

# XXX: https://github.com/lxc/lxd/tree/master/doc

- name: initialize directories for LXC host and container usage
  when: >
    lxc.container.create_mode == 'build'
    and
    lxc.file_drop is defined
  become: true
  # XXX: 'include_role' didn't seem to like 'become'
  import_role:
    name: file_drop
  vars:
    file_drop: "{{ lxc.file_drop }}"


- name: install LXC to the host
  when: lxc.host is defined
  include_tasks: host.yml

# XXX: externally add user to 'lxd' group
# TODO: where is the default backing storage located? ZFS dataset?
# TODO: permissions supporting running docker in LXC


- name: setup target as lxc container
  when: lxc.container is defined
  include_tasks: container.yml



# TODO: https://lxd.readthedocs.io/en/latest/backup/#container-backup-and-restore

# XXX: adding the user to the user group 'lxd' enables root-like access to LXD
# this is similar in behavior with the `docker` group
