---
## --------------------- ##
## Installs ZFS on Linux ##
## --------------------- ##

- name: check if ZFS is installed
  shell: 'type zfs'
  ignore_errors: true
  register: zfs_exists

- name: install zfs
  when: zfs_exists.rc != 0
  block:
    - name: detect Debian ZFS install
      when: ansible_facts['distribution'] == "Debian"
      import_tasks: install_zfs_debian.yml

    - name: detect Arch Linux ZFS install
      when: ansible_facts['distribution'] == "Archlinux"
      import_tasks: install_zfs_arch.yml

    - name: fail on unsupported distributions
      when: >
        ansible_facts['distribution'] != "Debian" and
        ansible_facts['distribution'] != "Archlinux"
      fail:
        msg: "Only supports Debian and Arch Linux"

- shell: modinfo zfs | grep -v parm
  register: zfs_module_info

- name: module info
  debug: msg="{{ zfs_module_info.stdout_lines }}"
